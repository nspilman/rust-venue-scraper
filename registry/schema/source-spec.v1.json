{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/registry/source-spec.v1.json",
  "title": "Source Spec v1",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "source_id": { "type": "string", "minLength": 3, "maxLength": 100 },
    "identity": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "owner_team", "contact_email"],
      "properties": {
        "name": { "type": "string", "minLength": 1, "maxLength": 200 },
        "owner_team": { "type": "string", "minLength": 1, "maxLength": 100 },
        "contact_email": { "type": "string", "format": "email" }
      }
    },
    "enabled": { "type": "boolean" },
    "endpoints": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["url", "method"],
        "properties": {
          "url": { "type": "string", "format": "uri" },
          "method": { "type": "string", "enum": ["GET", "POST", "PUT", "DELETE", "HEAD", "PATCH"] }
        }
      }
    },
    "auth": {
      "type": "object",
      "additionalProperties": false,
      "required": ["method"],
      "properties": {
        "method": { "type": "string", "enum": ["none", "bearer", "basic", "api_key", "custom"] },
        "credential_ref": { "type": "string", "maxLength": 200 }
      }
    },
    "rate_limits": {
      "type": "object",
      "additionalProperties": false,
      "required": ["requests_per_min", "bytes_per_min", "concurrency"],
      "properties": {
        "requests_per_min": { "type": "integer", "minimum": 0 },
        "bytes_per_min": { "type": "integer", "minimum": 0 },
        "concurrency": { "type": "integer", "minimum": 1 }
      }
    },
    "content": {
      "type": "object",
      "additionalProperties": false,
      "required": ["allowed_mime_types", "max_payload_size_bytes"],
      "properties": {
        "allowed_mime_types": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        "max_payload_size_bytes": { "type": "integer", "minimum": 0 }
      }
    },
    "policy": {
      "type": "object",
      "additionalProperties": false,
      "required": ["license_id", "robots_tos_posture", "pii_risk_class", "pii_action"],
      "properties": {
        "license_id": { "type": "string", "minLength": 2 },
        "robots_tos_posture": { "type": "string", "enum": ["respect", "ignore-with-approval"] },
        "pii_risk_class": { "type": "string", "enum": ["low", "medium", "high"] },
        "pii_action": { "type": "string", "enum": ["allow", "mask", "quarantine"] }
      }
    },
    "change_detection": {
      "type": "object",
      "additionalProperties": false,
      "required": ["strategy"],
      "properties": { "strategy": { "type": "string", "enum": ["etag", "last_modified", "snapshot", "none"] } }
    },
    "parse_plan_ref": { "type": "string", "minLength": 1, "maxLength": 200 },
    "cadence": {
      "type": "object",
      "additionalProperties": false,
      "required": ["cron", "timezone"],
      "properties": {
        "cron": { "type": "string", "minLength": 1, "maxLength": 200 },
        "timezone": { "type": "string", "minLength": 1, "maxLength": 100 }
      }
    },
    "allowed_hours": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["days", "start", "end", "timezone"],
        "properties": {
          "days": { "type": "array", "items": { "type": "string", "enum": ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"] }, "minItems": 1 },
          "start": { "type": "string", "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$" },
          "end": { "type": "string", "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$" },
          "timezone": { "type": "string" }
        }
      }
    }
  },
  "required": [
    "source_id",
    "identity",
    "enabled",
    "endpoints",
    "auth",
    "rate_limits",
    "content",
    "policy",
    "change_detection",
    "parse_plan_ref"
  ]
}
