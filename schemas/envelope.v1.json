{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/envelope.v1.json",
  "title": "Envelope v1",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "envelope_version": { "type": "string", "const": "1.0.0" },
    "envelope_id": { "type": "string", "format": "uuid" },
    "source_id": { "type": "string", "minLength": 3, "maxLength": 200 },
    "idempotency_key": { "type": "string", "minLength": 8, "maxLength": 256 },
    "payload_meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["mime_type", "size_bytes", "checksum"],
      "properties": {
        "mime_type": { "type": "string", "minLength": 3, "maxLength": 200 },
        "encoding": { "type": "string" },
        "size_bytes": { "type": "integer", "minimum": 0 },
        "checksum": {
          "type": "object",
          "additionalProperties": false,
          "required": ["sha256"],
          "properties": {
            "sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" }
          }
        }
      }
    },
    "content": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "schema_hint": { "type": "string", "maxLength": 200 }
      }
    },
    "request": {
      "type": "object",
      "additionalProperties": false,
      "required": ["url"],
      "properties": {
        "url": { "type": "string", "format": "uri" },
        "method": { "type": "string" },
        "status": { "type": "integer", "minimum": 100, "maximum": 999 },
        "etag": { "type": "string" },
        "last_modified": { "type": "string", "format": "date-time" }
      }
    },
    "timing": {
      "type": "object",
      "additionalProperties": false,
      "required": ["fetched_at"],
      "properties": {
        "fetched_at": { "type": "string", "format": "date-time" },
        "observed_at": { "type": "string", "format": "date-time" },
        "gateway_received_at": { "type": "string", "format": "date-time" }
      }
    },
    "legal": {
      "type": "object",
      "additionalProperties": false,
      "required": ["license_id"],
      "properties": {
        "license_id": { "type": "string", "minLength": 2, "maxLength": 100 },
        "terms_url": { "type": "string", "format": "uri" },
        "attribution": { "type": "string", "maxLength": 500 }
      }
    },
    "geo_hint": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "crs": { "type": "string" },
        "centroid": {
          "type": "object",
          "additionalProperties": false,
          "required": ["lat", "lon"],
          "properties": {
            "lat": { "type": "number", "minimum": -90, "maximum": 90 },
            "lon": { "type": "number", "minimum": -180, "maximum": 180 }
          }
        },
        "city_code": { "type": "string", "maxLength": 50 }
      }
    },
    "payload_ref": { "type": "string", "maxLength": 512 },
    "trace": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "trace_id": { "type": "string", "maxLength": 128 },
        "attempt": { "type": "integer", "minimum": 1 }
      }
    },
    "ext": { "type": "object" }
  },
  "required": [
    "envelope_version",
    "source_id",
    "idempotency_key",
    "payload_meta",
    "request",
    "timing",
    "legal"
  ]
}

